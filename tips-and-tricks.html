<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 9 Tips and Tricks | IDEA R&amp;A Manual</title>
<meta name="author" content="Chris Haid, Edison Coronado, Mishan Jensen, Maura Carter, Steven Macapagal, Aline Orr, Ilissa Madrigal, Marlena Coco">
<meta name="description" content="This section of the R&amp;A Manual is for sharing various tricks that are will make you life easier. Rules of thumb, explanations of how things work, and useful design patterns are all fair game.  9.1...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content="Chapter 9 Tips and Tricks | IDEA R&amp;A Manual">
<meta property="og:type" content="book">
<meta property="og:url" content="https://idea-analytics.github.io/r_and_a_manual/tips-and-tricks.html">
<meta property="og:description" content="This section of the R&amp;A Manual is for sharing various tricks that are will make you life easier. Rules of thumb, explanations of how things work, and useful design patterns are all fair game.  9.1...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 9 Tips and Tricks | IDEA R&amp;A Manual">
<meta name="twitter:description" content="This section of the R&amp;A Manual is for sharing various tricks that are will make you life easier. Rules of thumb, explanations of how things work, and useful design patterns are all fair game.  9.1...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.9/grViz.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">IDEA R&amp;A Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> A little about this manual</a></li>
<li><a class="" href="who.html"><span class="header-section-number">2</span> Who we are</a></li>
<li><a class="" href="the-data-warehouse-and-how-to-access-it.html"><span class="header-section-number">3</span> The Data Warehouse and how to access it</a></li>
<li><a class="" href="key-tables-measures-and-metrics.html"><span class="header-section-number">4</span> Key Tables, Measures, and Metrics</a></li>
<li><a class="" href="projects.html"><span class="header-section-number">5</span> Projects</a></li>
<li><a class="" href="coding-standards.html"><span class="header-section-number">6</span> Coding Standards</a></li>
<li><a class="" href="visualization-standards.html"><span class="header-section-number">7</span> Visualization Standards</a></li>
<li><a class="" href="models-and-methods.html"><span class="header-section-number">8</span> Models and Methods</a></li>
<li><a class="active" href="tips-and-tricks.html"><span class="header-section-number">9</span> Tips and Tricks</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/idea-analytics/r_and_a_manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tips-and-tricks" class="section level1">
<h1>
<span class="header-section-number">9</span> Tips and Tricks<a class="anchor" aria-label="anchor" href="#tips-and-tricks"><i class="fas fa-link"></i></a>
</h1>
<p>This section of the R&amp;A Manual is for sharing various tricks that are will make you life easier. Rules of thumb, explanations of how things work, and useful design patterns are all fair game.</p>
<div id="data-processing" class="section level2">
<h2>
<span class="header-section-number">9.1</span> Data processing<a class="anchor" aria-label="anchor" href="#data-processing"><i class="fas fa-link"></i></a>
</h2>
<div id="de-duplicating-rows-in-a-table." class="section level3">
<h3>
<span class="header-section-number">9.1.1</span> De-duplicating rows in a table.<a class="anchor" aria-label="anchor" href="#de-duplicating-rows-in-a-table."><i class="fas fa-link"></i></a>
</h3>
<p>There are two general purpose design patterns for de-duplicating rows in a table in either R or SQL.</p>
<ol style="list-style-type: decimal">
<li><p>In R use the <code><a href="https://dplyr.tidyverse.org/reference/distinct.html">dplyr::distinct()</a></code> function and in SQL use a DISTINCT clause. This is pretty simple and robust, with the typical use case of wanting to reduce many <strong>identical</strong> rows to a single row.</p></li>
<li>
<p>If you are trying to de-duplicate where you may have <strong>non-identical</strong> rows (e.g., a student has taken the same assessment multiple times in a testing window and you’d like to get the latest date) then you can use a <code>group_by-arrange-row_number-filter</code> pattern:</p>
<ol style="list-style-type: decimal">
<li>Group you data by the columns that uniquely identify your object of inquiry (e.g., student number)</li>
<li>Arrange or sort the data by a column that puts an ordering you care about within the grouped data (e.g., assessment date)</li>
<li>Create a new column that contains the row number <em>within the group</em> (e.g, a student with 5 assessments in a window would have <code>row_number = 1</code> for the first date and <code>row_number = 5</code> for the last date).</li>
<li>Filter for the maximum row number(with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> in R or a <code>WHERE</code> clause in SQL)</li>
<li>(optional) Ungroup your data.</li>
</ol>
</li>
</ol>
</div>
<div id="hierarchical-aggregation-or-the-list-group_by-trick" class="section level3">
<h3>
<span class="header-section-number">9.1.2</span> Hierarchical aggregation, or the <code>list-group_by</code> trick<a class="anchor" aria-label="anchor" href="#hierarchical-aggregation-or-the-list-group_by-trick"><i class="fas fa-link"></i></a>
</h3>
<p>Schools data, especially student-level data, is embedded in hierarchical groupings.</p>
<p>Let’s look at the <a href="https://www.zillow.com/research/data/">Zillow Home Value Index</a> for all homes (i.e, single family homes, condos, and coops), which is smoothed, seasonally adjusted measure of the typical home value and market changes across a given region It reflects the typical value for homes in the 35th to 65th percentile range at the neighborhood level. These home values are available for every month from January 2000 to May 2022.</p>
<p>It’s a very large dataset so we’ll use the apache Arrow Project’s feather file to read the data into R and subset the housing costs to IDEA metro areas</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/">arrow</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'arrow'</span>
<span class="co">#&gt; The following object is masked from 'package:utils':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     timestamp</span>
<span class="va">zillow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_feather.html">read_feather</a></span><span class="op">(</span><span class="st">"./zillow.feather"</span><span class="op">)</span>


<span class="va">idea_metros</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>Metro <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Austin-Round Rock"</span>,
                                <span class="st">"Dallas-Fort Worth-Arlington"</span>,
                                <span class="st">"San Antonio-New Braunfels"</span>,
                                <span class="st">"Brownsville-Harlingen"</span>,
                                <span class="st">"El Paso"</span>,
                                <span class="st">"Houston-The Woodlands-Sugar Land"</span>,
                                <span class="st">"Baton Rouge"</span>,
                                <span class="st">"Tampa-St. Petersburg-Clearwater"</span>,
                                <span class="st">"Jacksonville"</span>,
                                <span class="st">"Cincinnati"</span>
                                <span class="op">)</span>
                      <span class="op">)</span>



<span class="va">zillow_idea</span> <span class="op">&lt;-</span> <span class="va">zillow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">idea_metros</span>, by <span class="op">=</span> <span class="st">"Metro"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">RegionID</span><span class="op">:</span><span class="va">CountyName</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"202*-"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html">clean_names</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">#zillow_idea</span></code></pre></div>
<p>These data are nested: we have 22 years of home prices within neighborhoods, cities, counties, metro areas, and states. Often we’d like to do aggregations by over these various level. That is, we’d like to know the mean home price for each neighborhood, city and county. A typical work flow to achieve this is to write a <a href="https://dplyr.tidyverse.org">dplyr</a> pipeline for one <code>group_by</code> combination and then copy-and-paste that pipeline and change the columns in the <code>group_by</code> call. While this works in a pinch, its repetitive (violating <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">the DRY doctrine</a>), prone to copying errors and leaves with a bunch of dataframe that are have increasingly awkward names.</p>
<p>A more elegant solution is to leverage <a href="http://purrr.tidyverse.org">purrr</a>’s <code>map_df</code> function and to pass it a listy of already grouped data frames. Here’s a simple example:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>

<span class="va">zillow_idea_county_state</span> <span class="op">&lt;-</span> <span class="va">zillow_idea</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># create a list of grouped data.frames</span>
  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">county_name</span>, <span class="va">state</span><span class="op">)</span>, <span class="co"># the . is a  placeholder for the data.frame being piped in </span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">state</span><span class="op">)</span>
  <span class="op">)</span><span class="op">}</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span><span class="op">{</span>
    <span class="va">.x</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># .x is a placeholder for each element of list above passed to map_df</span>
      <span class="co"># across allows us to apply a function to every column satisfying a condition</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"x20"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'county_name'. You can</span>
<span class="co">#&gt; override using the `.groups` argument.</span>
  

<span class="co">#head(zillow_idea_county_state)</span></code></pre></div>
<p>We now have a data frame with county-level <em>and</em> state-level means in one data frame. Notice however that the <code>county_name</code> field is <code>NA</code> for state level data:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zillow_idea_county_state</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 19</span>
<span class="co">#&gt; # Groups:   county_name [1]</span>
<span class="co">#&gt;   county_name state x2020_01_31 x2020_02_29 x2020_03_31</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;NA&gt;        FL        257794.     259999.     262739.</span>
<span class="co">#&gt; 2 &lt;NA&gt;        LA        179935.     181797.     183616.</span>
<span class="co">#&gt; 3 &lt;NA&gt;        OH        198424.     199450.     201128.</span>
<span class="co">#&gt; 4 &lt;NA&gt;        TX        266042.     267043.     268646.</span>
<span class="co">#&gt; # … with 14 more variables: x2020_04_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_05_31 &lt;dbl&gt;, x2020_06_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_07_31 &lt;dbl&gt;, x2020_08_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_09_30 &lt;dbl&gt;, x2020_10_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_11_30 &lt;dbl&gt;, x2020_12_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2022_01_31 &lt;dbl&gt;, x2022_02_28 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2022_03_31 &lt;dbl&gt;, x2022_04_30 &lt;dbl&gt;, …</span></code></pre></div>
<p>This makes sense, since <code>map_df</code> uses <code>bind_rows</code> to concatonate the aggregated tables together and will fill columns that are missing in data frame with NA values. With simple example like this we could add an extra step at the end of our pipline to provide more information:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zillow_idea_county_state</span> <span class="op">&lt;-</span> <span class="va">zillow_idea</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># create a list of grouped data.frames</span>
  <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">county_name</span>, <span class="va">state</span><span class="op">)</span>, <span class="co"># the . is a  placeholder for the data.frame being piped in </span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">state</span><span class="op">)</span>
  <span class="op">)</span><span class="op">}</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="op">~</span><span class="op">{</span>
    <span class="va">.x</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># .x is a placeholder for each element of list above passed to map_df</span>
      <span class="co"># across allows us to apply a function to every column satisfying a condition</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"x20"</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">.x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">replace_na</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>county_name <span class="op">=</span> <span class="st">"State Avg"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'county_name'. You can</span>
<span class="co">#&gt; override using the `.groups` argument.</span>

<span class="va">zillow_idea_county_state</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">county_name</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 0 × 19</span>
<span class="co">#&gt; # Groups:   county_name [0]</span>
<span class="co">#&gt; # … with 19 variables: county_name &lt;chr&gt;, state &lt;chr&gt;,</span>
<span class="co">#&gt; #   x2020_01_31 &lt;dbl&gt;, x2020_02_29 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_03_31 &lt;dbl&gt;, x2020_04_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_05_31 &lt;dbl&gt;, x2020_06_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_07_31 &lt;dbl&gt;, x2020_08_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_09_30 &lt;dbl&gt;, x2020_10_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_11_30 &lt;dbl&gt;, x2020_12_31 &lt;dbl&gt;, …</span>

<span class="va">zillow_idea_county_state</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">county_name</span> <span class="op">==</span> <span class="st">"State Avg"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 4 × 19</span>
<span class="co">#&gt; # Groups:   county_name [1]</span>
<span class="co">#&gt;   county_name state x2020_01_31 x2020_02_29 x2020_03_31</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 State Avg   FL        257794.     259999.     262739.</span>
<span class="co">#&gt; 2 State Avg   LA        179935.     181797.     183616.</span>
<span class="co">#&gt; 3 State Avg   OH        198424.     199450.     201128.</span>
<span class="co">#&gt; 4 State Avg   TX        266042.     267043.     268646.</span>
<span class="co">#&gt; # … with 14 more variables: x2020_04_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_05_31 &lt;dbl&gt;, x2020_06_30 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_07_31 &lt;dbl&gt;, x2020_08_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_09_30 &lt;dbl&gt;, x2020_10_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2020_11_30 &lt;dbl&gt;, x2020_12_31 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2022_01_31 &lt;dbl&gt;, x2022_02_28 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   x2022_03_31 &lt;dbl&gt;, x2022_04_30 &lt;dbl&gt;, …</span></code></pre></div>
<p>Why have all of this one data frame? Because it can now be easily graphed:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">zillow_idea_county_state</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># pivot to a long table by year</span>
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"x"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"month"</span>, values_to <span class="op">=</span> <span class="st">"home_value"</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co"># let's clean up the month column by removing the leading x and casting to a date</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu">str_remove</span><span class="op">(</span><span class="va">month</span>, <span class="st">"x"</span><span class="op">)</span>, 
         month <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://purrr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span>, <span class="va">home_value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">county_name</span> <span class="op">==</span> <span class="st">"State Avg"</span>, group<span class="op">=</span><span class="va">county_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">state</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/zillow_graph-1.png" width="672"></div>
</div>
<div id="creating-scaffolds-when-joining-data." class="section level3">
<h3>
<span class="header-section-number">9.1.3</span> Creating “Scaffolds” when joining data.<a class="anchor" aria-label="anchor" href="#creating-scaffolds-when-joining-data."><i class="fas fa-link"></i></a>
</h3>
<p>Coming Soon. . .</p>
</div>
</div>
<div id="statistical-pitfalls" class="section level2">
<h2>
<span class="header-section-number">9.2</span> Statistical pitfalls<a class="anchor" aria-label="anchor" href="#statistical-pitfalls"><i class="fas fa-link"></i></a>
</h2>
<div id="simpsons-paradox" class="section level3">
<h3>
<span class="header-section-number">9.2.1</span> Simpson’s Paradox<a class="anchor" aria-label="anchor" href="#simpsons-paradox"><i class="fas fa-link"></i></a>
</h3>
<p>When identifying trends in a distribution, be careful of interpreting those trends, particularly when there is hierarchy involved in the population. The ranking, magnitude, and direction of the trends can reverse when conditioning on a certain level of a hierarchy. For example, STAAR achievement levels as a function of minutes on an individual learning program like Dreambox may not be significant at the district level, but could be significant when at the school or classroom level.</p>
</div>
<div id="bias-variance-tradeoff" class="section level3">
<h3>
<span class="header-section-number">9.2.2</span> Bias-variance tradeoff<a class="anchor" aria-label="anchor" href="#bias-variance-tradeoff"><i class="fas fa-link"></i></a>
</h3>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="models-and-methods.html"><span class="header-section-number">8</span> Models and Methods</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tips-and-tricks"><span class="header-section-number">9</span> Tips and Tricks</a></li>
<li>
<a class="nav-link" href="#data-processing"><span class="header-section-number">9.1</span> Data processing</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#de-duplicating-rows-in-a-table."><span class="header-section-number">9.1.1</span> De-duplicating rows in a table.</a></li>
<li><a class="nav-link" href="#hierarchical-aggregation-or-the-list-group_by-trick"><span class="header-section-number">9.1.2</span> Hierarchical aggregation, or the list-group_by trick</a></li>
<li><a class="nav-link" href="#creating-scaffolds-when-joining-data."><span class="header-section-number">9.1.3</span> Creating “Scaffolds” when joining data.</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#statistical-pitfalls"><span class="header-section-number">9.2</span> Statistical pitfalls</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#simpsons-paradox"><span class="header-section-number">9.2.1</span> Simpson’s Paradox</a></li>
<li><a class="nav-link" href="#bias-variance-tradeoff"><span class="header-section-number">9.2.2</span> Bias-variance tradeoff</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/idea-analytics/r_and_a_manual/blob/master/09-Tips_and_Tricks.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/idea-analytics/r_and_a_manual/edit/master/09-Tips_and_Tricks.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>IDEA R&amp;A Manual</strong>" was written by Chris Haid, Edison Coronado, Mishan Jensen, Maura Carter, Steven Macapagal, Aline Orr, Ilissa Madrigal, Marlena Coco. It was last built on 2022-06-17.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
