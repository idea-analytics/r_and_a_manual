# Data Access

```{r load_dw, include=FALSE}
rna_dw_usage <- readxl::read_excel("DataWarehouse Usage.xlsx") %>% 
  janitor::clean_names() %>% 
  select(r_and_a_uses = r_a_uses_x,
         server_name, 
         database_name, 
         table_name, 
         column_name, 
         data_type, 
         constraint) %>% 
  mutate(
         across(where(is.character), as_factor),
         r_and_a_uses = !is.na(r_and_a_uses)) %>% 
  distinct()

n_servers <- rna_dw_usage %>% distinct(server_name) %>% nrow()
n_dbs <- rna_dw_usage %>% distinct(database_name) %>% nrow()
n_tables <- rna_dw_usage %>% 
  select(server_name, database_name, table_name) %>% 
  distinct() %>% 
  nrow()
```

## The Data Warehouse
The 'data warehouse' is actually a collection of disparate databases hosted by IDEA Public Schools.  Some data bases are used to host the original source data, some are used as the data model for production applications.

While the IDEA has ~28 servers hosting SQL Server databases, R&A typically only accesses `r n_servers` servers hosting `r n_dbs` databases and `r prettyNum(n_tables, big.mark = ",")` distinct tables. It's a lot, for sure. 

### Core Data warehouse server configuration

The servers are not islands unot themselves, but rather form a small economy of data flows  

```{r server_graphs}
DiagrammeR::grViz("
  digraph data_wh {
    
    #graph statement
    graph [overlap = true, layout = dot, rankdir = LR]
  
    #node statement
    node [shape = cylinder, 
          style = filled, 
          fontname = Helvetica, 
          fillcolor= '#f9a054', 
          color = '#626363']
    DSPS; DSIII; DSOT 
  
    node [fillcolor= '#1a4784']
    PROD1; PROD2

    node [fillcolor= '#a4c364']
    RS2; RS1
  
  node [fillcolor= '#53b4cc']
  STHIS; RSHIS
 
  node [fillcolor = firebrick]
  FO1
  
  node [rank = 5, shape = box, fontname = Helvetica, fillcolor= '#ffde75', fontcolor = black]
    LOGI

  # subgraph statements
  subgraph cluster_ds {rank = same; style = dotted; DSPS; DSIII; DSOT}
  subgraph cluster_prod {rank = same; style = dotted; PROD1; PROD2}
  subgraph cluster_rs {rank = same; style = dotted; RS2; RS1}
  subgraph cluster_his {rank = same; style = dotted; STHIS; RSHIS}
  
    #edges statement
  edge [color = '#626363', arrowhead=vee]
  {DSPS DSIII DSOT} -> PROD1 
  {DSPS DSIII DSOT} -> PROD2
   PROD1 -> {DSOT DSIII} [color = gray, style=dashed]
   PROD1 -> RS2
   PROD2 -> RS1
  {PROD1 PROD2} -> FO1
  {PROD1 PROD2} -> STHIS
   STHIS -> RSHIS
  {RS2 RS1 RSHIS} -> LOGI
  
  }
                    
                  
                  ")



```




```{r display_dw_tables, echo=FALSE, warning=FALSE}
rna_dw_usage %>% 
  janitor::clean_names("title") %>% 
  DT::datatable(filter = "top", rownames = FALSE, )
```


### IP Addresses of current servers

For the fastest performance when working remotely it is best to directly access a database by using the IP address of the server rather than than the URL, which often has multiple hops over the network when resolving the DSN. Here's a list of known IP Addresses and server names.

| IP Adress   | Server Name       |
|-------------|-------------------|
|[REDACTED-IP]|   [REDACTED-HOST]     |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST]    |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST]    |
|[REDACTED-IP] |   [REDACTED-HOST] |
|[REDACTED-IP] |   [REDACTED-HOST]   |
|[REDACTED-IP]|   [REDACTED-HOST]  |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP] |   [REDACTED-HOST]    |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST]  |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP] |   [REDACTED-HOST]    |
|[REDACTED-IP]|   [REDACTED-HOST]  |
|[REDACTED-IP]|   [REDACTED-HOST] | 
|[REDACTED-IP] |   [REDACTED-HOST] |
|[REDACTED-IP]|   [REDACTED-HOST]        |
|[REDACTED-IP]|   [REDACTED-HOST] |
|[REDACTED-IP]|   1044407-SQLDS2  |
|[REDACTED-IP]|   [REDACTED-HOST]    |
|[REDACTED-IP] |   [REDACTED-HOST]  |
|[REDACTED-IP]|   [REDACTED-HOST]           |

: List of Windows Servers hosting SQL Server Databases and their IP Addresses


### Databases that R&A frquently uses. 
```{r}
rna_dw_usage %>% filter(r_and_a_uses) %>% 
  select(server_name, database_name) %>% 
  distinct() %>% 
  janitor::clean_names("title")
```
: List of Windows Servers hosting SQLServer DBs and their IP Addresses

