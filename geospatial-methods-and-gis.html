<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 11 Geospatial Methods and GIS | IDEA R&amp;A Manual</title>
<meta name="author" content="Chris Haid, Edison Coronado, Mishan Jensen, Maura Carter, Steven Macapagal, Aline Orr, Ilissa Madrigal, Marlena Coco">
<meta name="description" content="This chapter provides a gentle introduction to Geographic Information Systems (GIS) in R with simple features.  11.1 What is a simple feature? Simple Features is a set of ISO and Open Geospatial...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 11 Geospatial Methods and GIS | IDEA R&amp;A Manual">
<meta property="og:type" content="book">
<meta property="og:url" content="https://idea-analytics.github.io/r_and_a_manual/geospatial-methods-and-gis.html">
<meta property="og:description" content="This chapter provides a gentle introduction to Geographic Information Systems (GIS) in R with simple features.  11.1 What is a simple feature? Simple Features is a set of ISO and Open Geospatial...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 11 Geospatial Methods and GIS | IDEA R&amp;A Manual">
<meta name="twitter:description" content="This chapter provides a gentle introduction to Geographic Information Systems (GIS) in R with simple features.  11.1 What is a simple feature? Simple Features is a set of ISO and Open Geospatial...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.5.1/transition.js"></script><script src="libs/bs3compat-0.5.1/tabs.js"></script><script src="libs/bs3compat-0.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script><script src="libs/viz-1.8.2/viz.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/grViz-binding-1.0.10/grViz.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">IDEA R&amp;A Manual</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> A little about this manual</a></li>
<li><a class="" href="who.html"><span class="header-section-number">2</span> Contributors</a></li>
<li><a class="" href="the-data-warehouse-and-how-to-access-it.html"><span class="header-section-number">3</span> The Data Warehouse and How to Access It</a></li>
<li><a class="" href="key-tables-measures-and-metrics.html"><span class="header-section-number">4</span> Key Tables, Measures, and Metrics</a></li>
<li><a class="" href="projects.html"><span class="header-section-number">5</span> Projects</a></li>
<li><a class="" href="specific-projects.html"><span class="header-section-number">6</span> Specific Projects</a></li>
<li><a class="" href="evaluation-projects.html"><span class="header-section-number">7</span> Evaluation Projects</a></li>
<li><a class="" href="coding-standards.html"><span class="header-section-number">8</span> Coding Standards</a></li>
<li><a class="" href="visualization-standards.html"><span class="header-section-number">9</span> Visualization Standards</a></li>
<li><a class="" href="models-and-methods.html"><span class="header-section-number">10</span> Models and Methods</a></li>
<li><a class="active" href="geospatial-methods-and-gis.html"><span class="header-section-number">11</span> Geospatial Methods and GIS</a></li>
<li><a class="" href="surveys.html"><span class="header-section-number">12</span> Surveys</a></li>
<li><a class="" href="tips-and-tricks.html"><span class="header-section-number">13</span> Tips and Tricks</a></li>
<li><a class="" href="platforms.html"><span class="header-section-number">14</span> Platforms</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/idea-analytics/r_and_a_manual">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="geospatial-methods-and-gis" class="section level1" number="11">
<h1>
<span class="header-section-number">11</span> Geospatial Methods and GIS<a class="anchor" aria-label="anchor" href="#geospatial-methods-and-gis"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter provides a gentle introduction to Geographic Information Systems (GIS) in R with simple features.</p>
<div id="what-is-a-simple-feature" class="section level2" number="11.1">
<h2>
<span class="header-section-number">11.1</span> What is a simple feature?<a class="anchor" aria-label="anchor" href="#what-is-a-simple-feature"><i class="fas fa-link"></i></a>
</h2>
<p><strong>Simple Features</strong> is a set of ISO and Open Geospatial Consortium (OGC) standards that specify a common storage and access model of geographic feature made of mostly two-dimensional geometries (point, line, polygon, multi-point, multi-line, etc.) used by geographic information systems. Simple features underlie the most common commercial and open-source GIS platforms (e.g., ESRI ArcGIS, PostGIS, the GeoJSON standard).</p>
<p>A <strong>feature</strong> is essentially a thing in the world. In the simple feature specification a feature has <em>a geometry</em> describing where on Earth the feature is located, <strong>and they have attributes</strong>, which describe other properties, like names or metrics such as population.</p>
<div id="how-are-simple-features-implemented-in-r" class="section level3" number="11.1.1">
<h3>
<span class="header-section-number">11.1.1</span> How are simple features implemented in R<a class="anchor" aria-label="anchor" href="#how-are-simple-features-implemented-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>In a word, simply. A special feature in R is essentially a row in <code>data.frame</code> with class <strong>sf</strong>. This <code>data.frame</code> will have the normal suspects—names of things, metrics you care about—in columns and then a special column named <strong>geometry</strong> or <strong>geom</strong>. This will typically be a list-column, meaning that instead of holding characters or numbers, the contents are a list and each list is collection of 2-d coordinates that describe how to plot or draw the geometry. The image below illustrates the structure of an <code>sf</code> <code>data.frame</code></p>
<div class="inline-figure"><img src="img/sf_layout.png" width="500"></div>
</div>
</div>
<div id="lets-look-at-taco-schools" class="section level2" number="11.2">
<h2>
<span class="header-section-number">11.2</span> Let’s look at TACO schools<a class="anchor" aria-label="anchor" href="#lets-look-at-taco-schools"><i class="fas fa-link"></i></a>
</h2>
<p>Let’s start by getting schools in Tarrant County (TACO). We can get these schools and their addresses from the data warehouse:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="co">#library(tidyverse)</span></span>
<span><span class="co">#library(ideadata)</span></span>
<span></span>
<span><span class="co"># schools_conn &lt;- get_schools()</span></span>
<span></span>
<span><span class="co"># regions_conn &lt;- get_regions() %&gt;% </span></span>
<span><span class="co">#   filter(RegionDescription == "Tarrant County") %&gt;% </span></span>
<span><span class="co">#   select(RegionID)</span></span>
<span></span>
<span><span class="co"># taco_schools &lt;- schools_conn %&gt;% </span></span>
<span><span class="co">#   inner_join(regions_conn, by = "RegionID") %&gt;% </span></span>
<span><span class="co">#   select(SchoolShortName, SchoolStreet, SchoolCity, SchoolState, SchoolZipCode) %&gt;% </span></span>
<span><span class="co">#   distinct() %&gt;% </span></span>
<span><span class="co">#   collect() %&gt;% </span></span>
<span><span class="co">#   janitor::clean_names()  </span></span>
<span></span>
<span><span class="co">#taco_schools</span></span>
<span></span>
<span><span class="co">#save(taco_schools, file = "./taco_schools.Rda")</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="st">"./taco_schools.Rda"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">taco_schools</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;   school_short_name school_street   school_city school_state</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 Achieve           1900 Thomas Rd  Haltom City TX          </span></span>
<span><span class="co">#&gt; 2 Edgecliff         1640 Altamesa … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 3 Rise              3000 S Cherry … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 4 Southeast         2935 E Seminar… Fort Worth  TX          </span></span>
<span><span class="co">#&gt; # ℹ 1 more variable: school_zip_code &lt;dbl&gt;</span></span></code></pre></div>
<div id="geocoding" class="section level3" number="11.2.1">
<h3>
<span class="header-section-number">11.2.1</span> Geocoding<a class="anchor" aria-label="anchor" href="#geocoding"><i class="fas fa-link"></i></a>
</h3>
<p>We’ve got schools and addresses! But that isn’t sufficient to plot these schools on a map, and we certainly don’t have a simple features data.frame.</p>
<p>The first stop is <strong>geocoding</strong> these addresses, which is simply getting their latitude and longitude. Doing so is very straightforward for with the <code>[tidygeocoder](https://jessecambon.github.io/tidygeocoder/)</code> which provides a great interface to a number of different geocoders (e.g., US Census, OpenStreetMaps, geocod.io).</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jessecambon.github.io/tidygeocoder/">tidygeocoder</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">taco_schools_geocoded</span> <span class="op">&lt;-</span> <span class="va">taco_schools</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu">tidygeocoder</span><span class="fu">::</span><span class="fu"><a href="https://jessecambon.github.io/tidygeocoder/reference/geocode.html">geocode</a></span><span class="op">(</span>street <span class="op">=</span> <span class="va">school_street</span>,</span>
<span>            city <span class="op">=</span> <span class="va">school_city</span>,</span>
<span>            state <span class="op">=</span> <span class="va">school_state</span>,</span>
<span>            postalcode <span class="op">=</span> <span class="va">school_zip_code</span>, </span>
<span>            method <span class="op">=</span> <span class="st">"osm"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Passing 4 addresses to the Nominatim single address geocoder</span></span>
<span><span class="co">#&gt; Query completed in: 4.1 seconds</span></span>
<span></span>
<span><span class="va">taco_schools_geocoded</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 7</span></span>
<span><span class="co">#&gt;   school_short_name school_street   school_city school_state</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 Achieve           1900 Thomas Rd  Haltom City TX          </span></span>
<span><span class="co">#&gt; 2 Edgecliff         1640 Altamesa … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 3 Rise              3000 S Cherry … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 4 Southeast         2935 E Seminar… Fort Worth  TX          </span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: school_zip_code &lt;dbl&gt;, lat &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   long &lt;dbl&gt;</span></span></code></pre></div>
<p>Brilliant! We’ve got <code>lat</code> and <code>long</code> variables for those addresses. Super Cool!</p>
<p>Let’s transform these now to a <code>sf</code> object:</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2()</span></span>
<span><span class="co">#&gt; is TRUE</span></span>
<span></span>
<span><span class="va">taco_schools_sf</span> <span class="op">&lt;-</span> <span class="va">taco_schools_geocoded</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">taco_schools_sf</span></span>
<span><span class="co">#&gt; Simple feature collection with 4 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -97.45087 ymin: 32.64811 xmax: -97.26259 ymax: 32.79013</span></span>
<span><span class="co">#&gt; CRS:           NA</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 6</span></span>
<span><span class="co">#&gt;   school_short_name school_street   school_city school_state</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;           &lt;chr&gt;       &lt;chr&gt;       </span></span>
<span><span class="co">#&gt; 1 Achieve           1900 Thomas Rd  Haltom City TX          </span></span>
<span><span class="co">#&gt; 2 Edgecliff         1640 Altamesa … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 3 Rise              3000 S Cherry … Fort Worth  TX          </span></span>
<span><span class="co">#&gt; 4 Southeast         2935 E Seminar… Fort Worth  TX          </span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: school_zip_code &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   geometry &lt;POINT&gt;</span></span></code></pre></div>
<p>Notice that the <code>lat</code> and <code>long</code> variables are replaced by the <code>geometry</code> column.</p>
<div id="coordinate-reference-system" class="section level4" number="11.2.1.1">
<h4>
<span class="header-section-number">11.2.1.1</span> Coordinate Reference System<a class="anchor" aria-label="anchor" href="#coordinate-reference-system"><i class="fas fa-link"></i></a>
</h4>
<p>Notice in the meta-data above that CRS is <code>NA</code>. CRS refers to the Coordinate Reference System, which is a framework for measuring locations precisely as coordinates. A CRS includes a coordinate system, a horizontal datum that binds the coordinates to a real space on the spheroid Earth with an estimate of the Earth’s curvature and a set of control points, and finally a projection that converts spherical coordinates to Cartesian coordinates.</p>
<p>You should always set this and the most common CRS in latitude and longitude as WGS84 (used by the GPS satellite navigation system) with the following CRS string <code>"+init=epsg:4326"</code> as a formal identifier, but also more simply by its name:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">taco_schools_sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"WGS84"</span></span></code></pre></div>
</div>
</div>
<div id="plotting" class="section level3" number="11.2.2">
<h3>
<span class="header-section-number">11.2.2</span> Plotting<a class="anchor" aria-label="anchor" href="#plotting"><i class="fas fa-link"></i></a>
</h3>
<p>We now have enough information to draw a map!</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#renv::install("yutannihilation/ggsflabel")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap">ggmap</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,</span></span>
<span><span class="co">#&gt; which was just loaded, were retired in October 2023.</span></span>
<span><span class="co">#&gt; Please refer to R-spatial evolution reports for details, especially</span></span>
<span><span class="co">#&gt; https://r-spatial.org/r/2023/05/15/evolution4.html.</span></span>
<span><span class="co">#&gt; It may be desirable to make the sf package available;</span></span>
<span><span class="co">#&gt; package maintainers should consider adding sf to Suggests:.</span></span>
<span><span class="co">#&gt; ℹ Google's Terms of Service: &lt;https://mapsplatform.google.com&gt;</span></span>
<span><span class="co">#&gt; ℹ Please cite ggmap if you use it! Use `citation("ggmap")` for details.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'ggmap'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:tidygeocoder':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     geocode</span></span>
<span></span>
<span><span class="va">base_google_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_googlemap.html">get_googlemap</a></span><span class="op">(</span><span class="st">"76117"</span>, zoom <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ &lt;https://maps.googleapis.com/maps/api/staticmap?center=76117&amp;zoom=11&amp;size=640x640&amp;scale=2&amp;maptype=terrain&amp;key=xxx&gt;</span></span>
<span><span class="co">#&gt; ℹ &lt;https://maps.googleapis.com/maps/api/geocode/json?address=76117&amp;key=xxx&gt;</span></span>
<span></span>
<span></span>
<span><span class="va">base_google_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>, color <span class="op">=</span> <span class="st">"hotpink"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggsflabel</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/ggsflabel/reference/geom_sf_label.html">geom_sf_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"hotpink"</span>,</span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span><span class="co">#&gt; system, which will replace the existing one.</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/ggmap-1.png" width="672"></div>
<p>I don’t always love Google Maps’ look for display purposes on slides, so let’s change that up with Stamen Maps:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Need a bounding box for the get_stamenmap function</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/bb2bbox.html">bb2bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">base_google_map</span>, <span class="st">"bb"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">base_stamen_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html">get_stamenmap</a></span><span class="op">(</span><span class="va">bbox</span>, zoom<span class="op">=</span><span class="fl">11</span>, maptype <span class="op">=</span> <span class="st">"toner-lite"</span><span class="op">)</span></span>
<span><span class="co">#&gt; ℹ Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under ODbL.</span></span>
<span></span>
<span><span class="va">base_stamen_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>, color <span class="op">=</span> <span class="st">"hotpink"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggsflabel</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/ggsflabel/reference/geom_sf_label.html">geom_sf_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"hotpink"</span>,</span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span><span class="co">#&gt; system, which will replace the existing one.</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/unnamed-chunk-32-1.png" width="672"></div>
</div>
<div id="getting-drive-times" class="section level3" number="11.2.3">
<h3>
<span class="header-section-number">11.2.3</span> Getting drive times<a class="anchor" aria-label="anchor" href="#getting-drive-times"><i class="fas fa-link"></i></a>
</h3>
<p>This requires the MapBox API, which requires an API key.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages("mapboxapi")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mapboxapi</span><span class="op">)</span></span>
<span><span class="co">#&gt; Usage of the Mapbox APIs is governed by the Mapbox Terms of Service.</span></span>
<span><span class="co">#&gt; Please visit https://www.mapbox.com/legal/tos/ for more information.</span></span>
<span></span>
<span><span class="va">drive_10min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mapboxapi/man/mb_isochrone.html">mb_isochrone</a></span><span class="op">(</span><span class="va">taco_schools_sf</span>, </span>
<span>                            profile <span class="op">=</span> <span class="st">"driving"</span>, </span>
<span>                            time <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">schools_drive_10min_sf</span> <span class="op">&lt;-</span><span class="va">drive_10min</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">taco_schools_sf</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">geometry</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">base_stamen_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">schools_drive_10min_sf</span>, </span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">school_short_name</span>,</span>
<span>              fill <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>, </span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>, </span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggsflabel</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/ggsflabel/reference/geom_sf_label.html">geom_sf_label_repel</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">taco_schools_sf</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">school_short_name</span>, color <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>,</span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span><span class="co">#&gt; system, which will replace the existing one.</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/unnamed-chunk-33-1.png" width="672"></div>
</div>
<div id="some-geographic-filtering" class="section level3" number="11.2.4">
<h3>
<span class="header-section-number">11.2.4</span> Some geographic filtering<a class="anchor" aria-label="anchor" href="#some-geographic-filtering"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Spherical geometry (s2) switched off</span></span>
<span><span class="va">taco_area_of_max_intersection</span> <span class="op">&lt;-</span> <span class="va">schools_drive_10min_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">school_short_name</span> <span class="op">==</span> <span class="st">"Edgecliff"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html">st_intersection</a></span><span class="op">(</span><span class="va">schools_drive_10min_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">school_short_name</span> <span class="op">==</span> <span class="st">"Southeast"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude,</span></span>
<span><span class="co">#&gt; st_intersection assumes that they are planar</span></span>
<span><span class="co">#&gt; Warning: attribute variables are assumed to be spatially</span></span>
<span><span class="co">#&gt; constant throughout all geometries</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">base_stamen_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_area_of_max_intersection</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"goldenrod"</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"goldenrod"</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>, </span>
<span>          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>, </span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">ggsflabel</span><span class="fu">::</span><span class="fu"><a href="https://yutannihilation.github.io/ggsflabel/reference/geom_sf_label.html">geom_sf_label_repel</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">taco_schools_sf</span>,</span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">school_short_name</span>, color <span class="op">=</span> <span class="va">school_short_name</span><span class="op">)</span>,</span>
<span>               inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"none"</span>, color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span><span class="co">#&gt; system, which will replace the existing one.</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span>
<span></span>
<span><span class="co">#&gt; Warning in st_point_on_surface.sfc(data$geometry):</span></span>
<span><span class="co">#&gt; st_point_on_surface may not give correct results for</span></span>
<span><span class="co">#&gt; longitude/latitude data</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/geo-filtering-1.png" width="672"></div>
<p>And what schools are found in this area?</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schools_in_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html">st_filter</a></span><span class="op">(</span><span class="va">taco_schools_sf</span>,</span>
<span>                         <span class="va">taco_area_of_max_intersection</span>, </span>
<span>                         join <span class="op">=</span> <span class="va">st_within</span><span class="op">)</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects</span></span>
<span><span class="co">#&gt; assumes that they are planar</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects</span></span>
<span><span class="co">#&gt; assumes that they are planar</span></span>
<span></span>
<span><span class="va">schools_in_overlap</span></span>
<span><span class="co">#&gt; Simple feature collection with 0 features and 5 fields</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: NA ymin: NA xmax: NA ymax: NA</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 0 × 6</span></span>
<span><span class="co">#&gt; # ℹ 6 variables: school_short_name &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   school_street &lt;chr&gt;, school_city &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   school_state &lt;chr&gt;, school_zip_code &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   geometry &lt;GEOMETRY [°]&gt;</span></span></code></pre></div>
<p>It may look like Edgecliff is within the 10-minute drive time overlap area, but in truth it is just outside of the boundary.</p>
</div>
</div>
<div id="census-data" class="section level2" number="11.3">
<h2>
<span class="header-section-number">11.3</span> Census Data<a class="anchor" aria-label="anchor" href="#census-data"><i class="fas fa-link"></i></a>
</h2>
<p>Kyle Walker has written the exceptional <code>[tidycensus](https://walker-data.com/tidycensus/)</code>package, with fantastic documentation, which allows you to pull US Census data sources (including the Decennial Census and the yearly American Community Survey).</p>
<p>Let’s load it up:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#install.packages('tidycensus')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/">tidycensus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># NEt command saves Census API key to your .Renviron file</span></span>
<span><span class="co">#census_api_key("YOUR API KEY GOES HERE")</span></span>
<span><span class="co">#census_api_key(Sys.getenv("CENSUS_API_KEY"))</span></span></code></pre></div>
<div id="getting-basic-data" class="section level5" number="11.3.0.0.1">
<h5>
<span class="header-section-number">11.3.0.0.1</span> Getting Basic Data<a class="anchor" aria-label="anchor" href="#getting-basic-data"><i class="fas fa-link"></i></a>
</h5>
<p>There are two major functions implemented in tidycensus:</p>
<ul>
<li>
<code><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial()</a></code>, which grants access to the 2000, 2010, and 2020 decennial US Census APIs, and</li>
<li>
<code><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs()</a></code>, which grants access to the 1-year and 5-year American Community Survey APIs.</li>
</ul>
<p>Let’s get <em>median age by state</em> in 2010:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_decennial.html">get_decennial</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"state"</span>, </span>
<span>                       variables <span class="op">=</span> <span class="st">"P013001"</span>, </span>
<span>                       year <span class="op">=</span> <span class="fl">2010</span><span class="op">)</span></span>
<span><span class="co">#&gt; Getting data from the 2010 decennial Census</span></span>
<span><span class="co">#&gt; Using Census Summary File 1</span></span>
<span></span>
<span><span class="va">age10</span></span>
<span><span class="co">#&gt; # A tibble: 52 × 4</span></span>
<span><span class="co">#&gt;    GEOID NAME        variable value</span></span>
<span><span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 01    Alabama     P013001   37.9</span></span>
<span><span class="co">#&gt;  2 02    Alaska      P013001   33.8</span></span>
<span><span class="co">#&gt;  3 04    Arizona     P013001   35.9</span></span>
<span><span class="co">#&gt;  4 05    Arkansas    P013001   37.4</span></span>
<span><span class="co">#&gt;  5 06    California  P013001   35.2</span></span>
<span><span class="co">#&gt;  6 22    Louisiana   P013001   35.8</span></span>
<span><span class="co">#&gt;  7 21    Kentucky    P013001   38.1</span></span>
<span><span class="co">#&gt;  8 08    Colorado    P013001   36.1</span></span>
<span><span class="co">#&gt;  9 09    Connecticut P013001   40  </span></span>
<span><span class="co">#&gt; 10 10    Delaware    P013001   38.8</span></span>
<span><span class="co">#&gt; # ℹ 42 more rows</span></span></code></pre></div>
<p>Plotting is super duper easy:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age10</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">NAME</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/unnamed-chunk-36-1.png" width="672"></div>
</div>
<div id="searching-for-variables" class="section level5" number="11.3.0.0.2">
<h5>
<span class="header-section-number">11.3.0.0.2</span> Searching for variables<a class="anchor" aria-label="anchor" href="#searching-for-variables"><i class="fas fa-link"></i></a>
</h5>
<p>How, pray tell, does one know that <code>P013001</code> is the variable for median age? Getting variables from the Census or ACS requires knowing the variable ID - and there are thousands of these IDs across the different Census files. To rapidly search for variables, use the <code><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables()</a></code> function. There are <a href="https://walker-data.com/tidycensus/articles/basic-usage.html#searching-for-variables">more details on in the package’s documentation page</a>.</p>
<p>To browse these variables, assign the result of <code><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables()</a></code> to a variable and use the <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> function in RStudio. An optional argument <code>cache = TRUE</code> will cache the dataset on your computer for future use.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">v_2020</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/load_variables.html">load_variables</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="st">"acs5"</span>, cache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#View(v_2020)</span></span></code></pre></div>
<p>Let’s get Tarrant county:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">tarr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html">get_acs</a></span><span class="op">(</span>geography <span class="op">=</span> <span class="st">"block group"</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span> <span class="co">#tpotal pop</span></span>
<span>                                                    <span class="st">"B01001_001"</span>, </span>
<span>                                                   </span>
<span>                                                    <span class="co">#male</span></span>
<span>                                                   <span class="st">"B01001_004"</span>, <span class="co">#5-9</span></span>
<span>                                                   <span class="st">"B01001_005"</span>, <span class="co">#10-14</span></span>
<span>                                                   <span class="st">"B01001_006"</span>, <span class="co">#15-17</span></span>
<span>                                                    </span>
<span>                                                   <span class="co">#Femaile</span></span>
<span>                                                   <span class="st">"B01001_028"</span>, <span class="co">#5-9</span></span>
<span>                                                   <span class="st">"B01001_029"</span>, <span class="co">#10-14</span></span>
<span>                                                   <span class="st">"B01001_030"</span><span class="op">)</span>,<span class="co">#15-17</span></span>
<span>                state <span class="op">=</span> <span class="st">"TX"</span>, county <span class="op">=</span> <span class="st">"Tarrant"</span>, geometry <span class="op">=</span> <span class="cn">TRUE</span>, year <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tarr</span></span></code></pre></div>
</div>
</div>
<div id="chloropleth" class="section level2" number="11.4">
<h2>
<span class="header-section-number">11.4</span> Chloropleth<a class="anchor" aria-label="anchor" href="#chloropleth"><i class="fas fa-link"></i></a>
</h2>
<p>Now we are summing up all school aged children (5-17 year old boy and girls):</p>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/unnamed-chunk-38-1.png" width="672"></div>
</div>
<div id="dot-density" class="section level2" number="11.5">
<h2>
<span class="header-section-number">11.5</span> Dot-density<a class="anchor" aria-label="anchor" href="#dot-density"><i class="fas fa-link"></i></a>
</h2>
<p>Areal representation of data suffer from a few problems. One problem is that geographically large areas draw the eye and can often over-emphasize those areas versus smaller geographies. This distortion is familiar to those who follow elections, where geographically large states with small populations, like Wyoming, loom larger than geographically small, but densely populated states, like Delaware (Wyoming has 1/2 the population of Delaware, but 42x the land mass). This distortion occurs with Census geographies because blocks, block groups, and tracts are created to have roughly equal populations (e.g., Census tracts generally have a population size between 1,200 and 8,000 people, with an optimum size of 4,000 people); these geographies are consequently larger in rural places than in urban centers.</p>
<p>A second issue is that it’s very hard to show heterogeneity in spatial distributions. The plot above shows estimates of the count of all children aged 5-17 years in each tract. But, we may be interested in how differently distributed those students are.</p>
<p>A method to remedy both issues is to use <strong>dot-density</strong> plots which simply plot a sample of points within each geography for each group (often down sampled where each dot represents some number of people (e.g., 20 or 100 persons per dot). It’s pretty straightforward to get what you need by using <a href="https://walker-data.com/tidycensus/reference/as_dot_density.html"><code>sf::as_dot_density()</code></a></p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acs_ages</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">variable</span>,     <span class="op">~</span><span class="va">age_range</span>, <span class="op">~</span><span class="va">gender</span>,</span>
<span>  <span class="st">"B01001_001"</span>,    <span class="st">"All"</span>,      <span class="st">"All"</span>,  </span>
<span>                                                   </span>
<span>    <span class="co">#male</span></span>
<span>   <span class="st">"B01001_004"</span>, <span class="st">"5-9"</span>,   <span class="st">"Male"</span>,</span>
<span>   <span class="st">"B01001_005"</span>, <span class="st">"10-14"</span>, <span class="st">"Male"</span>,</span>
<span>   <span class="st">"B01001_006"</span>, <span class="st">"15-17"</span>, <span class="st">"Male"</span>,</span>
<span>    </span>
<span>   <span class="co">#Femaile</span></span>
<span>   <span class="st">"B01001_028"</span>, <span class="st">"5-9"</span>,    <span class="st">"female"</span>,</span>
<span>   <span class="st">"B01001_029"</span>, <span class="st">"10-14"</span>, <span class="st">"female"</span>,</span>
<span>   <span class="st">"B01001_030"</span>, <span class="st">"15-17"</span>, <span class="st">"female"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">tarr_childs</span> <span class="op">&lt;-</span> <span class="va">tarr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">acs_ages</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">gender</span> <span class="op">!=</span> <span class="st">"All"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">variable</span>, <span class="op">-</span><span class="va">moe</span>, <span class="op">-</span><span class="va">gender</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">GEOID</span>, <span class="va">NAME</span>, <span class="va">age_range</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_children <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(variable)`</span></span>
<span></span>
<span></span>
<span><span class="va">tarr_dots</span> <span class="op">&lt;-</span> <span class="va">tarr_childs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://walker-data.com/tidycensus/reference/as_dot_density.html">as_dot_density</a></span><span class="op">(</span></span>
<span>    value <span class="op">=</span> <span class="st">"n_children"</span>,</span>
<span>    values_per_dot <span class="op">=</span> <span class="fl">20</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"age_range"</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects</span></span>
<span><span class="co">#&gt; assumes that they are planar</span></span>
<span><span class="co">#&gt; although coordinates are longitude/latitude, st_intersects</span></span>
<span><span class="co">#&gt; assumes that they are planar</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">base_stamen_map</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html">ggmap</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tarr_dots</span>, </span>
<span>         <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">age_range</span><span class="op">)</span>, </span>
<span>         inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>         alpha  <span class="op">=</span> <span class="fl">.25</span>,</span>
<span>         size<span class="op">=</span><span class="fl">.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_area_of_max_intersection</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"goldenrod"</span>,</span>
<span>          fill <span class="op">=</span> <span class="st">"goldenrod"</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">.2</span>,</span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taco_schools_sf</span>, </span>
<span>              inherit.aes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>          color <span class="op">=</span> <span class="st">"green"</span>, </span>
<span>          size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">scale_color_viridis</span><span class="op">(</span>option <span class="op">=</span> <span class="st">"viridis"</span>, discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Coordinate system already present. Adding new coordinate</span></span>
<span><span class="co">#&gt; system, which will replace the existing one.</span></span></code></pre></div>
<div class="inline-figure"><img src="r-and-a-manual_files/figure-html/dot_density_map-1.png" width="672"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="models-and-methods.html"><span class="header-section-number">10</span> Models and Methods</a></div>
<div class="next"><a href="surveys.html"><span class="header-section-number">12</span> Surveys</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#geospatial-methods-and-gis"><span class="header-section-number">11</span> Geospatial Methods and GIS</a></li>
<li>
<a class="nav-link" href="#what-is-a-simple-feature"><span class="header-section-number">11.1</span> What is a simple feature?</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#how-are-simple-features-implemented-in-r"><span class="header-section-number">11.1.1</span> How are simple features implemented in R</a></li></ul>
</li>
<li>
<a class="nav-link" href="#lets-look-at-taco-schools"><span class="header-section-number">11.2</span> Let’s look at TACO schools</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#geocoding"><span class="header-section-number">11.2.1</span> Geocoding</a></li>
<li><a class="nav-link" href="#plotting"><span class="header-section-number">11.2.2</span> Plotting</a></li>
<li><a class="nav-link" href="#getting-drive-times"><span class="header-section-number">11.2.3</span> Getting drive times</a></li>
<li><a class="nav-link" href="#some-geographic-filtering"><span class="header-section-number">11.2.4</span> Some geographic filtering</a></li>
</ul>
</li>
<li><a class="nav-link" href="#census-data"><span class="header-section-number">11.3</span> Census Data</a></li>
<li><a class="nav-link" href="#chloropleth"><span class="header-section-number">11.4</span> Chloropleth</a></li>
<li><a class="nav-link" href="#dot-density"><span class="header-section-number">11.5</span> Dot-density</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/idea-analytics/r_and_a_manual/blob/master/08a-GIS.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/idea-analytics/r_and_a_manual/edit/master/08a-GIS.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>IDEA R&amp;A Manual</strong>" was written by Chris Haid, Edison Coronado, Mishan Jensen, Maura Carter, Steven Macapagal, Aline Orr, Ilissa Madrigal, Marlena Coco. It was last built on 2023-10-16.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
